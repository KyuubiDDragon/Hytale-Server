# ============================================================
# Hytale Dedicated Server - Docker Compose
# ============================================================
#
# SETUP FÜR PORTAINER:
# 1. Dieses Repo als Stack hinzufügen (Repository URL)
# 2. EINE der Download-Optionen unten konfigurieren
# 3. Deploy klicken
# 4. Nach dem Start: /auth login device ausführen
#
# ============================================================

services:
  hytale:
    build: .
    image: hytale-server:latest
    container_name: hytale
    hostname: hytale
    restart: unless-stopped
    
    environment:
      # ====================
      # Java / RAM Settings
      # ====================
      - JAVA_MIN_RAM=3G
      - JAVA_MAX_RAM=4G
      
      # ====================
      # Server Settings  
      # ====================
      - SERVER_PORT=5520
      - SERVER_BIND=0.0.0.0
      - TZ=Europe/Berlin
      
      # ====================
      # Backup Settings
      # ====================
      - ENABLE_BACKUP=true
      - BACKUP_FREQUENCY=30
      
      # ====================
      # Auth Mode
      # ====================
      # authenticated = Online-Modus (Standard)
      # offline = LAN-only ohne Auth
      # - AUTH_MODE=offline
      
      # ============================================================
      # SERVER FILES DOWNLOAD - WÄHLE EINE OPTION:
      # ============================================================
      #
      # OPTION A: Eigene URLs (empfohlen)
      # ---------------------------------
      # Lade die Dateien auf deinen eigenen Server/NAS hoch
      # und gib hier die URLs an:
      #
      # - SERVER_JAR_URL=https://dein-nas.local/hytale/HytaleServer.jar
      # - ASSETS_URL=https://dein-nas.local/hytale/Assets.zip
      #
      # OPTION B: Offizieller Hytale Downloader
      # ---------------------------------------
      # Nutzt den offiziellen Downloader (erfordert OAuth2 Login)
      # Nach dem ersten Start musst du dich einmalig authentifizieren
      #
      # - USE_HYTALE_DOWNLOADER=true
      # - HYTALE_PATCHLINE=release
      #
      # OPTION C: Manuell (nach Container-Start)
      # ----------------------------------------
      # Dateien nach dem Start manuell kopieren:
      # docker cp HytaleServer.jar hytale:/opt/hytale/server/
      # docker cp Assets.zip hytale:/opt/hytale/server/
      #
      # ============================================================
      
      # Aktiviere EINE der Optionen oben durch Entfernen des #
      
    # ====================
    # Ports - UDP!
    # ====================
    ports:
      - "5520:5520/udp"
    
    # ====================
    # Persistent Volumes
    # ====================
    volumes:
      # Server-Dateien (persistent für Downloads)
      - hytale-server:/opt/hytale/server
      # Welten und Konfiguration
      - hytale-data:/opt/hytale/data
      # Backups
      - hytale-backups:/opt/hytale/backups
      # Plugins
      - hytale-plugins:/opt/hytale/plugins
      # Mods
      - hytale-mods:/opt/hytale/mods

    # ====================
    # Console Access
    # ====================
    stdin_open: true
    tty: true
    
    # ====================
    # Logging
    # ====================
    logging:
      driver: "json-file"
      options:
        max-size: "50m"
        max-file: "5"

# ============================================================
# Named Volumes (persistent!)
# ============================================================
volumes:
  hytale-server:
    name: hytale-server
  hytale-data:
    name: hytale-data
  hytale-backups:
    name: hytale-backups
  hytale-plugins:
    name: hytale-plugins
  hytale-mods:
    name: hytale-mods
